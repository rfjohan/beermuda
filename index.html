<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BEERMUDA Triangle - Mission</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Creepster&family=Inter:wght@300;400;600;700;900&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #000; color: #fff; overflow: hidden; height: 100vh; position: relative; }
        body::before { content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(ellipse at 20% 30%, rgba(0, 100, 150, 0.3) 0%, transparent 50%), radial-gradient(ellipse at 80% 70%, rgba(0, 150, 100, 0.2) 0%, transparent 50%), linear-gradient(180deg, #001a1a 0%, #000d0d 100%); pointer-events: none; z-index: 0; }
        #map-game { height: 100vh; width: 100%; position: fixed; top: 0; left: 0; filter: brightness(0.85) contrast(1.2) saturate(1.3) hue-rotate(10deg); }
        .progress-overlay { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; width: 90%; max-width: 500px; transition: all 0.3s ease; }
        .progress-toggle { background: rgba(0, 30, 30, 0.95); backdrop-filter: blur(20px); border: 2px solid rgba(0, 255, 170, 0.4); border-radius: 50px; padding: 16px 24px; cursor: pointer; text-align: center; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8), 0 0 20px rgba(0, 255, 170, 0.3); transition: all 0.3s ease; }
        .progress-toggle:hover { background: rgba(0, 40, 40, 0.95); border-color: rgba(0, 255, 170, 0.6); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.9), 0 0 30px rgba(0, 255, 170, 0.5); }
        .progress-toggle h2 { font-family: 'Creepster', cursive; font-size: 1.5rem; color: #00ffaa; text-shadow: 0 0 10px rgba(0, 255, 170, 0.5); margin: 0; }
        .progress-content { background: rgba(0, 30, 30, 0.95); backdrop-filter: blur(20px); border: 2px solid rgba(0, 255, 170, 0.4); border-radius: 20px; margin-top: 12px; max-height: 0; overflow: hidden; transition: max-height 0.3s ease, padding 0.3s ease, opacity 0.3s ease; opacity: 0; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.8), 0 0 20px rgba(0, 255, 170, 0.3); }
        .progress-content.expanded { max-height: 70vh; padding: 20px; opacity: 1; overflow-y: auto; }
        .progress-content::-webkit-scrollbar { width: 8px; }
        .progress-content::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.3); border-radius: 4px; }
        .progress-content::-webkit-scrollbar-thumb { background: rgba(0, 255, 170, 0.3); border-radius: 4px; }
        .progress-content::-webkit-scrollbar-thumb:hover { background: rgba(0, 255, 170, 0.5); }
        .progress-stats { display: flex; justify-content: space-around; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid rgba(0, 255, 170, 0.2); }
        .stat { text-align: center; }
        .stat-value { font-size: 2rem; font-weight: 900; color: #00ffaa; text-shadow: 0 0 10px rgba(0, 255, 170, 0.5); }
        .stat-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: rgba(0, 255, 170, 0.6); margin-top: 4px; }
        .pub-list { display: flex; flex-direction: column; gap: 12px; }
        .pub-card { background: rgba(0, 50, 50, 0.3); border: 2px solid rgba(0, 255, 170, 0.2); border-radius: 12px; padding: 16px; display: flex; align-items: center; justify-content: space-between; transition: all 0.3s ease; position: relative; }
        .pub-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background: rgba(0, 255, 170, 0.2); transition: all 0.3s ease; border-radius: 12px 0 0 12px; }
        .pub-card.current { border-color: rgba(0, 255, 170, 0.6); background: rgba(0, 60, 60, 0.4); }
        .pub-card.current::before { background: #00ffaa; box-shadow: 0 0 10px rgba(0, 255, 170, 0.5); }
        .pub-card.completed { border-color: rgba(0, 255, 136, 0.4); background: rgba(0, 80, 60, 0.3); }
        .pub-card.completed::before { background: #00ff88; }
        .pub-info { display: flex; align-items: center; gap: 12px; flex: 1; }
        .pub-icon { font-size: 1.8rem; filter: drop-shadow(0 0 8px rgba(0, 255, 170, 0.5)); }
        .pub-details h3 { font-size: 1rem; font-weight: 600; color: #00ffaa; margin-bottom: 2px; }
        .pub-coords { font-size: 0.7rem; color: rgba(0, 255, 170, 0.5); font-family: monospace; }
        button { background: linear-gradient(135deg, #00ffaa 0%, #00ccff 100%); color: #001a1a; border: none; padding: 10px 20px; font-size: 0.85rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0, 255, 170, 0.4); }
        button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 255, 170, 0.6); }
        .status-badge { padding: 6px 14px; border-radius: 20px; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }
        .status-badge.completed { background: rgba(0, 255, 136, 0.2); color: #00ff88; border: 1px solid rgba(0, 255, 136, 0.3); }
        .status-badge.pending { background: rgba(100, 100, 100, 0.2); color: rgba(255, 255, 255, 0.4); border: 1px solid rgba(255, 255, 255, 0.2); }
        .leaflet-popup-content-wrapper { background: rgba(0, 20, 20, 0.95); border: 2px solid rgba(0, 255, 170, 0.4); border-radius: 12px; backdrop-filter: blur(10px); }
        .leaflet-popup-content { color: #00ffaa; font-family: 'Inter', sans-serif; }
        .leaflet-popup-tip { background: rgba(0, 20, 20, 0.95); }
        @media (max-width: 768px) { .pub-card { flex-direction: column; text-align: center; gap: 12px; } .progress-overlay { width: 95%; } }
    </style>
</head>
<body>
    <div id="map-game"></div>
    <div class="progress-overlay">
        <div class="progress-toggle" onclick="toggleProgress()">
            <h2>‚öì BEERMUDA MISSION ‚öì</h2>
        </div>
        <div class="progress-content" id="progressContent">
            <div class="progress-stats">
                <div class="stat"><div class="stat-value" id="completedCount">0</div><div class="stat-label">Survived</div></div>
                <div class="stat"><div class="stat-value" id="remainingCount">3</div><div class="stat-label">Remaining</div></div>
            </div>
            <div class="pub-list" id="progress-list"></div>
        </div>
    </div>
    <script>
        var coords = [{"lat":57.712934,"lng":11.913643},{"lat":57.69229,"lng":11.951408},{"lat":57.685315,"lng":11.916218}];
        var names = ["Waypoint 1","Waypoint 2","Waypoint 3"];
        var currentPub = 0;
        var visitedPubs = [false,false,false];
        var gameMap;
        var isExpanded = false;
        function toggleProgress() {
            isExpanded = !isExpanded;
            var content = document.getElementById('progressContent');
            if (isExpanded) { content.classList.add('expanded'); }
            else { content.classList.remove('expanded'); }
        }
        function initGameMap() {
            gameMap = L.map('map-game', { center: [coords[0].lat, coords[0].lng], zoom: 13, zoomControl: false });
            L.control.zoom({ position: 'bottomright' }).addTo(gameMap);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap contributors', maxZoom: 19 }).addTo(gameMap);
            L.polygon(coords, { color: '#00ffaa', fillColor: '#00ccff', fillOpacity: 0.12, weight: 3, opacity: 0.6, dashArray: '10, 10' }).addTo(gameMap);
            coords.forEach(function(coord, i) {
                var isActive = i === currentPub && !visitedPubs[i];
                var isCompleted = visitedPubs[i];
                var iconHtml = '<div style="font-size: 44px; filter: drop-shadow(0 0 12px ';
                if (isCompleted) { iconHtml += 'rgba(0, 255, 136, 0.8));">‚úÖ</div>'; }
                else if (isActive) { iconHtml += 'rgba(0, 255, 170, 1));">üíÄ</div>'; }
                else { iconHtml += 'rgba(0, 255, 170, 0.5));">üç∫</div>'; }
                var icon = L.divIcon({ html: iconHtml, className: '', iconSize: [44, 44], iconAnchor: [22, 44] });
                var status = isCompleted ? '‚úì Conquered' : isActive ? '‚ö† Current Target' : 'üîí Locked';
                L.marker([coord.lat, coord.lng], {icon: icon}).bindPopup('<b>' + names[i] + '</b><br>' + status).addTo(gameMap);
            });
            gameMap.fitBounds(coords.map(function(c) { return [c.lat, c.lng]; }), {padding: [80, 80]});
            updateProgress();
            setTimeout(function() { gameMap.invalidateSize(); }, 250);
        }
        function updateProgress() {
            var progressList = document.getElementById('progress-list');
            progressList.innerHTML = '';
            var completed = visitedPubs.filter(function(v) { return v; }).length;
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('remainingCount').textContent = 3 - completed;
            coords.forEach(function(coord, i) {
                var pubCard = document.createElement('div');
                pubCard.className = 'pub-card';
                if (i === currentPub && !visitedPubs[i]) { pubCard.classList.add('current'); }
                if (visitedPubs[i]) { pubCard.classList.add('completed'); }
                var icon = visitedPubs[i] ? '‚úÖ' : (i === currentPub ? 'üíÄ' : 'üç∫');
                var actionHtml = '';
                if (visitedPubs[i]) { actionHtml = '<span class="status-badge completed">‚úì Done</span>'; }
                else if (i === currentPub) { actionHtml = '<button onclick="checkIn(' + i + ')">Check In</button>'; }
                else { actionHtml = '<span class="status-badge pending">Locked</span>'; }
                pubCard.innerHTML = '<div class="pub-info"><div class="pub-icon">' + icon + '</div><div class="pub-details"><h3>' + names[i] + '</h3><div class="pub-coords">' + coord.lat.toFixed(4) + ', ' + coord.lng.toFixed(4) + '</div></div></div>' + actionHtml;
                progressList.appendChild(pubCard);
            });
        }
        function checkIn(pubIndex) {
            if (pubIndex === currentPub && !visitedPubs[pubIndex]) {
                visitedPubs[pubIndex] = true;
                var nextPub = -1;
                for (var i = 0; i < 3; i++) { if (!visitedPubs[i]) { nextPub = i; break; } }
                if (nextPub === -1) { }
                else { currentPub = nextPub; }
                gameMap.remove();
                initGameMap();
            }
        }
        window.onload = function() { initGameMap(); };
    </script>
</body>
</html>